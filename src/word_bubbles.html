<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Word Bubbles</title>

		<style>
			circle.bubble {
				fill: #beccae;
				stroke: #beccae;
			}

			text {
				font-family: sans-serif;
				font-size: 15px;
				color: #000;
			}
		</style>
	</head>
	<body>
		<script src="https://d3js.org/d3.v4.min.js"></script>
		<script>

			var width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
			var height = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
			var center = { x: width / 2, y: height / 2 };


			var forceStrength = 0.03;

			function charge(d) {
    			return -Math.pow(d.radius, 2.0) * forceStrength;
			}

			var svg = d3
				.select("body")
				.append("svg")
		    	.attr("width", width)
		    	.attr("height", height);

	    	var simulation = d3
	    		.forceSimulation()
	    		.velocityDecay(0.2)
	    		.force('x', d3.forceX().strength(forceStrength).x(center.x))
				.force('y', d3.forceY().strength(forceStrength).y(center.y))
		    	.force("charge", d3.forceManyBody().strength(charge));

		    d3.json("nodes.json", function(error, json) {
			  	if (error) throw error;

			  	var maxValue = d3.max(json, function(d) { return d.value; });
			  	var maxLeft = d3.max(json, function(d) { return d.left; });
			  	var maxRight = d3.max(json, function(d) { return d.right; });

			  	var scaleValue = d3
			  		.scalePow()
			  		.exponent(0.5)
      				.range([2, 85])
					.domain([0, maxValue]);

				var nodes = json.map(function(node) {
					return {
						name: node.name,
						value: node.value,
						radius: scaleValue(node.value),
						x: center.x - (((node.left - node.right) * (width / 2)) / node.value),
						y: center.y - ((node.value / maxValue) * (Math.random() > 0.5 ? -1 : 1) * (height / 2))
					};
				}).sort(function(x, y) { return x.value - y.value; });

			  	var bubbles = svg
			  		.selectAll(".bubble")
			      	.data(nodes)
			      	.enter().append('circle')
      				.classed('bubble', true)
      				.attr('r', function(d) { return d.radius; })
      				.attr('stroke-width', 2);

	  			var lables = bubbles
	  				.append("text")
	  				.text(function(d) { return d.name; })
	  				.attr('font-size', function(d) { return 20; })
      				.attr('x', 20)
      				.attr('y', 40)
      				.attr('text-anchor', 'middle');

				/*var titles = bubbles
					.append("title")
					.text(function(d) { return d.name; });*/

	  			simulation
	  				.nodes(nodes)
	  				.on('tick', ticked);
	  			
	  			function ticked() {
    				bubbles
      					.attr('cx', function (d) { return d.x; })
      					.attr('cy', function (d) { return d.y; });
				}
			});

		</script>
	</body>
</html>
